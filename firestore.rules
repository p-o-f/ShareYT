// LOCAL VERSION = SOURCE OF TRUTH. ENSURE LOCAL VERSION IS IN SYNC WITH FIREBASE CONSOLE RULES, BECAUSE firebase deploy WILL OVERWRITE CONSOLE RULES ALWAYS.
// To deploy: firebase deploy --only firestore:rules

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Deny read/write by default
    match /{document=**} {
      allow read, write: if false;
    }

    // Friend Requests:
    // - Read: Only the user themselves can read their own request document.
    // - Write: Denied (Handled by Cloud Functions).
    match /friendRequests/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false;
    }

    // Friendships:
    // - Read: Only the user themselves can read their own friendship document.
    // - Write: Denied (Handled by Cloud Functions).
    match /friendships/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false;
    }

    // Suggested Videos:
    // - Read: Users can read suggestions where they are the sender ('from') or the receiver ('to').
    // - Write: Denied (Handled by Cloud Functions).
    match /suggestedVideos/{videoId} {
      allow read: if request.auth != null && (
        resource.data.from == request.auth.uid || 
        resource.data.to == request.auth.uid
      );
      allow write: if false;
    }
  }
}
